<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login Member DocterBee | Masuk Akun Kesehatan Alami</title>
    <meta name="description" content="Masuk ke akun member DocterBee untuk melanjutkan perjalanan kesehatan alami Anda. Akses journey kesehatan, tukar poin reward, dan konsultasi dengan praktisi." />
    <meta name="keywords" content="login docterbee, masuk akun, member kesehatan, akun docterbee, login member" />
    <meta name="author" content="DocterBee" />
    <link rel="canonical" href="https://docterbee.com/login" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Login Member DocterBee | Masuk Akun" />
    <meta property="og:description" content="Masuk ke akun member DocterBee untuk melanjutkan perjalanan kesehatan alami Anda." />
    <meta property="og:image" content="https://docterbee.com/assets/images/logo-docterbee.png" />
    <meta property="og:url" content="https://docterbee.com/login" />
    <meta property="og:locale" content="id_ID" />
    <meta property="og:site_name" content="DocterBee" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Login Member DocterBee" />
    <meta name="twitter:description" content="Masuk ke akun member untuk akses journey kesehatan dan reward." />
    <meta name="twitter:image" content="https://docterbee.com/assets/images/logo-docterbee.png" />
    
    <!-- Structured Data - WebPage -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Login Member DocterBee",
        "description": "Halaman login untuk member DocterBee",
        "url": "https://docterbee.com/login",
        "isPartOf": {"@type": "WebSite", "name": "DocterBee", "url": "https://docterbee.com/"}
      }
    </script>
    
    <!-- Structured Data - BreadcrumbList -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {"@type": "ListItem", "position": 1, "name": "Beranda", "item": "https://docterbee.com/"},
          {"@type": "ListItem", "position": 2, "name": "Login", "item": "https://docterbee.com/login"}
        ]
      }
    </script>

    <!-- External Stylesheets -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" type="image/png" sizes="48x48" href="https://docterbee.com/assets/images/favicon.png" />
    <link rel="shortcut icon" href="https://docterbee.com/assets/images/favicon.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/landing-page.css" />
    <style>
      main,
      main section,
      main aside,
      main div {
        opacity: 1 !important;
        transform: none !important;
      }
    </style>
  </head>
  <body class="bg-gray-50 text-slate-900">
    <!-- Header Navigation -->
    <header class="sticky top-0 z-50 bg-white/95 backdrop-blur border-b border-gray-200">
      <div class="mx-auto max-w-6xl px-4 h-16 flex items-center justify-between">
        <a href="/" class="flex items-center gap-2">
          <img src="assets/images/logo-docterbee.png" alt="DocterBee" class="logo-img" />
        </a>
        <nav
          class="hidden md:flex gap-6 text-sm"
          style="justify-content: flex-end; padding: 0; width: auto"
        >
          <a href="/" class="nav-link">Home</a>
          <a href="/register" class="nav-link">Daftar</a>
          <a href="/login" class="nav-link active">Login</a>
          <a href="/member-check" class="nav-link">Cek Member</a>
        </nav>
        <button class="hamburger-btn md:hidden" id="hamburgerBtn" aria-label="Menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </header>

    <!-- Mobile Menu Overlay -->
    <div id="mobileMenuOverlay" class="mobile-menu-overlay hidden"></div>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="mobile-menu">
      <div class="mobile-menu-header">
        <div class="logo-box" style="margin: 0">
          <img
            src="assets/images/logo-docterbee.png"
            alt="DocterBee"
            style="height: 48px; width: auto"
          />
        </div>
        <button class="mobile-menu-close" id="mobileMenuClose" aria-label="Close">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <nav class="mobile-nav">
        <a href="/" class="mobile-nav-link">Beranda</a>
        <a href="/register" class="mobile-nav-link">Daftar</a>
        <a href="/login" class="mobile-nav-link">Login</a>
        <a href="/member-check" class="mobile-nav-link">Cek Member</a>
      </nav>
    </div>

    <!-- Login Form -->
    <main class="mx-auto max-w-md px-4 py-12">
      <div class="bg-white rounded-2xl shadow-lg p-8">
        <h1 class="text-3xl font-bold text-center mb-2">Masuk Akun</h1>
        <p class="text-center text-slate-600 mb-8">
          Silakan masuk untuk melanjutkan perjalanan kesehatan Anda
        </p>

        <form id="loginForm">
          <div class="mb-4">
            <label for="email" class="block text-sm font-semibold mb-2">Email</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent outline-none"
              placeholder="email@example.com"
            />
          </div>

          <div class="mb-6">
            <label for="password" class="block text-sm font-semibold mb-2">Password</label>
            <input
              type="password"
              id="password"
              name="password"
              required
              minlength="6"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent outline-none"
              placeholder="Minimal 6 karakter"
            />
          </div>

          <button
            type="submit"
            class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 rounded-lg transition-colors duration-200"
          >
            Masuk
          </button>
        </form>

        <p class="text-center text-sm text-slate-600 mt-6">
          Belum punya akun?
          <a href="/register" class="text-amber-600 hover:text-amber-700 font-semibold"
            >Daftar sekarang</a
          >
        </p>
        <p class="text-center text-sm text-slate-600 mt-3">
          Lupa password?
          <button 
             onclick="openForgotPasswordModal()"
             class="text-amber-600 hover:text-amber-700 font-semibold bg-transparent border-none p-0 cursor-pointer">
            Klik di sini
          </button>
        </p>
      </div>
    </main>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="hidden fixed inset-0 bg-black/60 z-[100] items-center justify-center p-4">
      <div class="bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">Lupa Password</h2>
          <button onclick="closeForgotPasswordModal()" class="text-gray-400 hover:text-gray-600">
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>
        </div>
        
        <div id="forgotPasswordFormContainer">
          <p class="text-slate-600 mb-6 text-sm">
            Masukkan email Anda di bawah ini. Kami akan mengirimkan link untuk mereset password akun Anda.
          </p>

          <form id="forgotPasswordForm">
            <div class="mb-6">
              <label for="forgotEmail" class="block text-sm font-semibold mb-2">Email</label>
              <input
                type="email"
                id="forgotEmail"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent outline-none"
                placeholder="email@example.com"
              />
            </div>

            <button
              type="submit"
              id="forgotPasswordSubmit"
              class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 rounded-lg transition-colors duration-200"
            >
              Kirim Link Reset
            </button>
          </form>
        </div>
        
        <div id="forgotPasswordSuccess" class="hidden text-center">
          <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i data-lucide="mail" class="w-8 h-8 text-emerald-600"></i>
          </div>
          <p class="text-slate-900 font-semibold mb-2">Email Terkirim!</p>
          <p class="text-slate-600 text-sm mb-6">
            Silakan cek kotak masuk (atau spam) email Anda untuk instruksi selanjutnya.
          </p>
          <button 
            onclick="closeForgotPasswordModal()"
            class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-3 rounded-lg transition-colors"
          >
            Tutup
          </button>
        </div>
      </div>
    </div>


    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      lucide.createIcons();
    </script>
    <script src="js/modal-utils.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/script.js"></script>
    <script src="js/landing-navbar.js"></script>

    <!-- User Data Sync Helper -->
    <script src="js/user-data-sync.js"></script>

    <!-- Login Logic -->
    <script>
      const loginForm = document.getElementById("loginForm");

      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;

        if (!email || !password) {
          showWarning("Email dan password harus diisi");
          return;
        }

        try {
          const response = await fetch("/api/auth/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            credentials: "include",
            body: JSON.stringify({ email, password }),
          });

          const data = await response.json();

          if (data.success) {
            // Initialize user data sync and load from database
            const userId = data.data.id;
            await window.UserDataSync.init(userId);

            showSuccess(
              `Selamat datang, ${data.data.name}! Anda akan diarahkan ke Journey.`,
              "Login Berhasil"
            );
            setTimeout(() => {
              window.location.href = "/journey";
            }, 1500);
          } else {
            showError(data.error || "Login gagal. Periksa email dan password Anda.");
          }
        } catch (error) {
          console.error("Login error:", error);
          showError("Terjadi kesalahan saat login. Pastikan server berjalan.");
        }
      });
      // Forgot Password Modal Logic
      const forgotModal = document.getElementById("forgotPasswordModal");
      const forgotFormContainer = document.getElementById("forgotPasswordFormContainer");
      const forgotForm = document.getElementById("forgotPasswordForm");
      const forgotSuccess = document.getElementById("forgotPasswordSuccess");

      window.openForgotPasswordModal = () => {
        forgotModal.classList.remove("hidden");
        forgotModal.classList.add("flex");
        forgotFormContainer.classList.remove("hidden");
        forgotSuccess.classList.add("hidden");
        // Reset form
        forgotForm.reset();
      };

      window.closeForgotPasswordModal = () => {
        forgotModal.classList.add("hidden");
        forgotModal.classList.remove("flex");
      };

      forgotForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = document.getElementById("forgotEmail").value.trim();
        const submitBtn = document.getElementById("forgotPasswordSubmit");
        const originalText = submitBtn.innerText;

        try {
          submitBtn.disabled = true;
          submitBtn.innerText = "Mengirim...";

          const response = await fetch("/api/auth/forgot-password", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email }),
          });

          const data = await response.json();

          if (data.success) {
            forgotFormContainer.classList.add("hidden");
            forgotSuccess.classList.remove("hidden");
            if (window.lucide) window.lucide.createIcons();
          } else {
            showError(data.error || "Gagal mengirim permintaan reset password");
          }
        } catch (error) {
          console.error("Forgot password request error:", error);
          showError("Terjadi kesalahan teknis");
        } finally {
          submitBtn.disabled = false;
          submitBtn.innerText = originalText;
        }
      });
    </script>


    <!-- ================= FOOTER ================= -->
    <footer>
      <div class="container">
        <div class="footer-content">
          <div>© 2025 DocterBee. All rights reserved.</div>
          <div>
            Berbasis <strong>Sains & Alam</strong>. | <a href="#">Privacy</a> ·
            <a href="#">Terms</a>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>
