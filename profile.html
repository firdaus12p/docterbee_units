<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile – Docterbee Member</title>

    <!-- External Stylesheets -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" type="image/png" href="assets/images/favicon.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/landing-page.css" />
    <link rel="stylesheet" href="css/card-preview.css" />
    <style>
      .profile-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem 1rem;
      }

      .profile-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        padding: 2rem;
        color: white;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .profile-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 1rem;
        border: 3px solid rgba(255, 255, 255, 0.3);
      }

      .profile-info-card {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      .info-row {
        display: flex;
        padding: 1rem 0;
        border-bottom: 1px solid #e5e7eb;
      }

      .info-row:last-child {
        border-bottom: none;
      }

      .info-label {
        font-weight: 600;
        color: #64748b;
        min-width: 140px;
      }

      .info-value {
        color: #1f2937;
        flex: 1;
      }

      @media (max-width: 768px) {
        .profile-container {
          padding: 1rem;
        }

        .profile-header {
          padding: 1.5rem;
        }

        .profile-info-card {
          padding: 1.5rem;
        }

        .info-row {
          flex-direction: column;
          gap: 0.5rem;
        }

        .info-label {
          min-width: auto;
        }
      }
      main,
      main section,
      main div {
        opacity: 1 !important;
        transform: none !important;
      }

      /* Activity History Styles */
      .activity-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1.5rem;
      }
      .filter-chips {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      .filter-chip {
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        border: 1px solid #e5e7eb;
        background: white;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.875rem;
      }
      .filter-chip:hover {
        border-color: #667eea;
      }
      .filter-chip.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border-color: transparent;
      }
      .date-filters {
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }
      .date-filters input {
        padding: 0.5rem;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        font-size: 0.875rem;
      }
      .btn-apply-date {
        padding: 0.5rem 1rem;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.875rem;
      }
      .btn-apply-date:hover {
        background: #5a67d8;
      }

      .activities-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .activity-card {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .activity-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-color: #667eea;
      }
      .activity-card.order {
        border-left: 4px solid #10b981;
      }
      .activity-card.reward {
        border-left: 4px solid #f59e0b;
      }
      .activity-icon {
        font-size: 1.5rem;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        flex-shrink: 0;
      }
      .activity-icon.order {
        background: #d1fae5;
      }
      .activity-icon.reward {
        background: #fef3c7;
      }
      .activity-info {
        flex: 1;
        min-width: 0;
      }
      .activity-title {
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.25rem;
      }
      .activity-date {
        font-size: 0.875rem;
        color: #6b7280;
      }
      .activity-amount {
        text-align: right;
        flex-shrink: 0;
      }
      .activity-value {
        font-weight: 600;
        color: #1f2937;
      }
      .activity-points {
        font-size: 0.75rem;
        color: #6b7280;
      }

      .status-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
      }
      .status-pending {
        background: #fef3c7;
        color: #b45309;
      }
      .status-completed,
      .status-approved {
        background: #d1fae5;
        color: #047857;
      }
      .status-cancelled,
      .status-rejected {
        background: #fee2e2;
        color: #b91c1c;
      }
      .status-expired {
        background: #e5e7eb;
        color: #6b7280;
      }

      .activities-loading {
        text-align: center;
        padding: 2rem;
        color: #6b7280;
      }
      .activities-empty {
        text-align: center;
        padding: 3rem;
        color: #9ca3af;
      }
      .activities-empty svg {
        width: 64px;
        height: 64px;
        margin: 0 auto 1rem;
        opacity: 0.5;
      }

      .activities-pagination {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-top: 1.5rem;
      }
      .page-btn {
        padding: 0.5rem 1rem;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        background: white;
        cursor: pointer;
        transition: all 0.2s;
      }
      .page-btn:hover:not(:disabled) {
        border-color: #667eea;
      }
      .page-btn.active {
        background: #667eea;
        color: white;
        border-color: #667eea;
      }
      .page-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* Receipt Modal Styles */
      .receipt-modal {
        max-width: 400px;
        margin: 0 auto;
        font-family: 'Courier New', monospace;
      }
      .receipt-header {
        text-align: center;
        border-bottom: 2px dashed #e5e7eb;
        padding-bottom: 1rem;
        margin-bottom: 1rem;
      }
      .receipt-logo {
        font-size: 1.5rem;
        font-weight: bold;
        color: #667eea;
      }
      .receipt-order-number {
        font-size: 1.25rem;
        font-weight: bold;
        margin: 0.5rem 0;
      }
      .receipt-info {
        margin-bottom: 1rem;
      }
      .receipt-info-row {
        display: flex;
        justify-content: space-between;
        padding: 0.25rem 0;
        font-size: 0.875rem;
      }
      .receipt-items {
        border-top: 1px dashed #e5e7eb;
        border-bottom: 1px dashed #e5e7eb;
        padding: 1rem 0;
        margin-bottom: 1rem;
      }
      .receipt-item {
        display: flex;
        justify-content: space-between;
        padding: 0.25rem 0;
        font-size: 0.875rem;
      }
      .receipt-item-name {
        flex: 1;
      }
      .receipt-item-qty {
        width: 40px;
        text-align: center;
      }
      .receipt-item-price {
        width: 100px;
        text-align: right;
      }
      .receipt-summary {
        margin-bottom: 1rem;
      }
      .receipt-summary-row {
        display: flex;
        justify-content: space-between;
        padding: 0.25rem 0;
        font-size: 0.875rem;
      }
      .receipt-total {
        font-size: 1.25rem;
        font-weight: bold;
        border-top: 2px solid #1f2937;
        padding-top: 0.5rem;
        margin-top: 0.5rem;
      }
      .receipt-footer {
        text-align: center;
        padding-top: 1rem;
        border-top: 2px dashed #e5e7eb;
        color: #6b7280;
        font-size: 0.75rem;
      }

      @media (max-width: 768px) {
        .activity-filters {
          flex-direction: column;
        }
        .date-filters {
          width: 100%;
        }
        .date-filters input {
          flex: 1;
        }
        .activity-card {
          flex-direction: column;
          text-align: center;
        }
        .activity-amount {
          text-align: center;
          margin-top: 0.5rem;
        }
      }

      /* Custom Activity Detail Modal */
      .activity-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
      }
      .activity-modal-box {
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 420px;
        width: 100%;
        max-height: 85vh;
        display: flex;
        flex-direction: column;
        animation: modalSlideIn 0.2s ease-out;
      }
      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: scale(0.95) translateY(-10px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }
      .activity-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #e5e7eb;
      }
      .activity-modal-header h3 {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1f2937;
        margin: 0;
      }
      .activity-modal-close {
        width: 32px;
        height: 32px;
        border: none;
        background: #f3f4f6;
        border-radius: 8px;
        font-size: 1.5rem;
        line-height: 1;
        cursor: pointer;
        color: #6b7280;
        transition: all 0.2s;
      }
      .activity-modal-close:hover {
        background: #e5e7eb;
        color: #1f2937;
      }
      .activity-modal-content {
        padding: 1.5rem;
        overflow-y: auto;
        flex: 1;
      }
      .activity-modal-footer {
        padding: 1rem 1.5rem;
        border-top: 1px solid #e5e7eb;
        display: flex;
        justify-content: center;
      }

      @media (max-width: 480px) {
        .activity-modal-box {
          max-height: 90vh;
          border-radius: 12px;
        }
        .activity-modal-content {
          padding: 1rem;
        }
        .receipt-modal {
          font-size: 0.875rem;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50 text-slate-900">
    <header>
      <div class="container">
        <nav>
          <a href="/" class="logo"
            ><img
              src="assets/images/logo-docterbee.png"
              alt="DocterBee"
              class="logo-img"
          /></a>
          <div class="nav-links">
            <a href="/" id="guestNavItem">Beranda</a>
            <a href="/store">Produk</a>
            <!-- Kesehatan Dropdown -->
            <div class="nav-dropdown">
              <button
                class="nav-dropdown-toggle"
                type="button"
                aria-haspopup="true"
                aria-expanded="false"
              >
                Kesehatan
                <svg
                  class="chevron-icon"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>
              <div class="nav-dropdown-menu">
                <a href="/periksa-kesehatan"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                  </svg>
                  Cek Kesehatan</a
                >
                <a href="/journey"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  Journey</a
                >
                <a href="/services"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  Services</a
                >
              </div>
            </div>
            <a href="/ai-advisor">AI Advisor</a>
            <a href="/events">Program</a>
            <div class="nav-dropdown">
              <button class="nav-dropdown-toggle" type="button">
                Media
                <svg
                  class="chevron-icon"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>
              <div class="nav-dropdown-menu">
                <a href="/about"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                  </svg>
                  Tentang Kami</a
                >
                <a href="/insight"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                  </svg>
                  Edukasi</a
                >
                <a href="/youtube-ai"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"
                    ></path>
                    <polygon
                      points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"
                    ></polygon>
                  </svg>
                  YouTube &amp; AI</a
                >
                <a href="/podcast"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                    <path
                      d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"
                    ></path>
                  </svg>
                  Podcast Audio</a
                >
              </div>
            </div>
            <div id="authButtons">
              <button
                class="btn btn-outline"
                onclick="location.href='/login'"
                style="margin-right: 8px"
              >
                Masuk</button
              ><button
                class="btn btn-primary"
                onclick="location.href='/register'"
              >
                Daftar Sekarang
              </button>
            </div>
            <div
              id="memberInfo"
              style="display: none; align-items: center; gap: 12px"
            >
              <span class="points-display" id="pointsDisplay"
                >Points: <b id="pointsValue">0</b></span
              ><a
                href="/profile"
                id="profileBtn"
                class="nav-link active"
                title="Profile"
                ><svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle></svg></a
              ><button id="logoutBtn" class="btn btn-outline-danger">
                Logout
              </button>
            </div>
          </div>
          <button class="hamburger-btn" id="hamburgerBtn" aria-label="Menu">
            <span></span><span></span><span></span>
          </button>
        </nav>
      </div>
    </header>

    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
    <div class="mobile-menu" id="mobileMenu">
      <div class="mobile-menu-header">
        <div class="logo-box" style="margin: 0">
          <img
            src="assets/images/logo-docterbee.png"
            alt="DocterBee"
            style="height: 48px; width: auto"
          />
        </div>
        <button
          class="mobile-menu-close"
          id="mobileMenuClose"
          aria-label="Close"
        >
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <nav class="mobile-nav">
        <a href="/" id="mobileGuestNavItem" class="mobile-nav-link">Beranda</a>
        <a href="/store" class="mobile-nav-link">Produk</a>
        <!-- Mobile Kesehatan Dropdown -->
        <div class="mobile-nav-dropdown" id="mobileKesehatanDropdown">
          <button
            class="mobile-nav-dropdown-toggle"
            type="button"
            aria-haspopup="true"
            aria-expanded="false"
          >
            Kesehatan
            <svg
              class="chevron-icon"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="mobile-nav-submenu">
            <a href="/periksa-kesehatan"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
              </svg>
              Cek Kesehatan</a
            >
            <a href="/journey"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              Journey</a
            >
            <a href="/services"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              Services</a
            >
          </div>
        </div>
        <a href="/ai-advisor" class="mobile-nav-link">AI Advisor</a>
        <a href="/events" class="mobile-nav-link">Program</a>
        <div class="mobile-nav-dropdown" id="mobileMediaDropdown">
          <button class="mobile-nav-dropdown-toggle" type="button">
            Media
            <svg
              class="chevron-icon"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="mobile-nav-submenu">
            <a href="/about"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
              </svg>
              Tentang Kami</a
            >
            <a href="/insight"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
              </svg>
              Edukasi</a
            >
            <a href="/youtube-ai"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"
                ></path>
                <polygon
                  points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"
                ></polygon>
              </svg>
              YouTube &amp; AI</a
            >
            <a href="/podcast"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                <path
                  d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"
                ></path>
              </svg>
              Podcast Audio</a
            >
          </div>
        </div>
        <div class="mobile-menu-actions">
          <div id="mobileAuthButtons">
            <button
              class="btn btn-outline"
              onclick="location.href='/login'"
              style="width: 100%"
            >
              Masuk</button
            ><button
              class="btn btn-primary"
              onclick="location.href='/register'"
              style="width: 100%"
            >
              Daftar Sekarang
            </button>
          </div>
          <div id="mobileMemberInfo" style="display: none">
            <div class="mobile-points-display" id="mobilePointsDisplay">
              Points: <b id="mobileNavPoints">0</b>
            </div>
            <a
              href="/profile"
              id="mobileProfileBtn"
              class="mobile-nav-link"
              style="display: flex; align-items: center; gap: 8px"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              Profile</a
            ><button
              id="mobileLogoutBtn"
              class="btn btn-outline-danger"
              style="width: 100%"
            >
              Logout
            </button>
          </div>
        </div>
      </nav>
    </div>

    <!-- Profile Content -->
    <main class="profile-container">
      <!-- Loading State -->
      <div id="loadingState" style="text-align: center; padding: 3rem">
        <p class="text-slate-600">Memuat data profile...</p>
      </div>

      <!-- Profile Content (Hidden initially) -->
      <div id="profileContent" style="display: none">
        <!-- Profile Header -->
        <div class="profile-header">
          <div class="profile-avatar" id="profileAvatar">U</div>
          <h1 class="text-2xl font-bold mb-1" id="profileName">Loading...</h1>
          <p class="opacity-90" id="profileEmail">loading@example.com</p>
        </div>

        <!-- Profile Information -->
        <div class="profile-info-card">
          <h2 class="text-xl font-bold mb-4">Informasi Akun</h2>
          <div class="info-row">
            <div class="info-label">Nama Lengkap</div>
            <div class="info-value" id="infoName">-</div>
          </div>
          <div class="info-row">
            <div class="info-label">Email</div>
            <div class="info-value" id="infoEmail">-</div>
          </div>
          <div class="info-row">
            <div class="info-label">Nomor Telepon</div>
            <div class="info-value" id="infoPhone">-</div>
          </div>
          <div class="info-row">
            <div class="info-label">Jenis Kartu</div>
            <div class="info-value" id="infoCardType">-</div>
          </div>
          <div class="info-row">
            <div class="info-label">Status Email</div>
            <div class="info-value" id="infoEmailStatus">
              <span class="text-gray-400">Loading...</span>
            </div>
          </div>
          <div id="verifyNowAction" class="mt-2" style="display: none;">
            <button 
              onclick="resendVerification()" 
              id="resendVerifyBtn"
              class="text-xs bg-amber-100 text-amber-700 font-bold px-3 py-1.5 rounded-lg border border-amber-200 hover:bg-amber-200 transition-colors flex items-center gap-1"
            >
              <i data-lucide="mail-warning" class="w-3.5 h-3.5"></i>
              Verifikasi Sekarang
            </button>
          </div>
        </div>

        <!-- Membership Card -->
        <div class="profile-info-card">
          <h2 class="text-xl font-bold mb-4">Kartu Member Anda</h2>
          <div class="card-preview-container" style="display: block">
            <div class="card-flip-wrapper" id="profileCardFlipWrapper">
              <!-- Front Face -->
              <div class="card-face card-face-front">
                <img
                  id="profileCardFrontImage"
                  src=""
                  alt="Card Front"
                  class="card-image"
                />
                <div class="card-overlay">
                  <div class="card-info" id="profileCardInfo">
                    <div class="card-name" id="profileCardNameDisplay">
                      Nama Anda
                    </div>
                    <div class="card-phone" id="profileCardPhoneDisplay">
                      08xxxxxxxxxx
                    </div>
                    <div class="card-points" id="profileCardPointsDisplay">
                      0 Points
                    </div>
                  </div>
                </div>
              </div>
              <!-- Back Face -->
              <div class="card-face card-face-back">
                <img
                  id="profileCardBackImage"
                  src=""
                  alt="Card Back"
                  class="card-image"
                />
              </div>
            </div>
            <div class="card-flip-hint">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                />
              </svg>
              Klik kartu untuk melihat bagian belakang
            </div>
          </div>
        </div>
      </div>

      <!-- Keamanan Akun Section (Change Password) -->
      <div class="profile-info-card">
        <h2 class="text-xl font-bold mb-4">🔐 Keamanan Akun</h2>
        <form id="changePasswordForm">
          <!-- Field 1: Password Saat Ini -->
          <div class="mb-4">
            <label for="currentPassword" class="block text-sm font-semibold mb-2">Password Saat Ini</label>
            <div class="relative">
              <input
                type="password"
                id="currentPassword"
                name="currentPassword"
                required
                autocomplete="current-password"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none pr-12"
                placeholder="Masukkan password yang Anda gunakan sekarang"
              />
              <button
                type="button"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
                onclick="togglePasswordVisibility('currentPassword', this)"
                aria-label="Toggle password visibility"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="eye-icon">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
            </div>
          </div>

          <!-- Field 2: Password Baru -->
          <div class="mb-4">
            <label for="newPassword" class="block text-sm font-semibold mb-2">Password Baru</label>
            <div class="relative">
              <input
                type="password"
                id="newPassword"
                name="newPassword"
                required
                minlength="6"
                autocomplete="new-password"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none pr-12"
                placeholder="Masukkan password baru"
              />
              <button
                type="button"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
                onclick="togglePasswordVisibility('newPassword', this)"
                aria-label="Toggle password visibility"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="eye-icon">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
            </div>
            <small class="text-gray-500">Minimal 6 karakter</small>
          </div>

          <!-- Field 3: Konfirmasi Password Baru -->
          <div class="mb-6">
            <label for="confirmPassword" class="block text-sm font-semibold mb-2">Konfirmasi Password Baru</label>
            <div class="relative">
              <input
                type="password"
                id="confirmPassword"
                name="confirmPassword"
                required
                autocomplete="new-password"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-400 focus:border-transparent outline-none pr-12"
                placeholder="Ketik ulang password baru"
              />
              <button
                type="button"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
                onclick="togglePasswordVisibility('confirmPassword', this)"
                aria-label="Toggle password visibility"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="eye-icon">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
            </div>
          </div>

          <button
            type="submit"
            id="changePasswordBtn"
            class="w-full bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white font-semibold py-3 rounded-lg transition-all duration-200"
          >
            Ubah Password
          </button>
        </form>
      </div>

      <!-- Activity History Section -->
      <div class="profile-info-card" id="activityHistorySection">
        <h2 class="text-xl font-bold mb-4">📋 Riwayat Aktivitas</h2>

        <!-- Filter Controls -->
        <div class="activity-filters">
          <div class="filter-chips">
            <button class="filter-chip active" data-type="all">Semua</button>
            <button class="filter-chip" data-type="order">🛒 Belanja</button>
            <button class="filter-chip" data-type="reward">🎁 Reward</button>
          </div>
          <div class="date-filters">
            <input type="date" id="activityStartDate" title="Dari tanggal" />
            <span style="color: #6b7280">-</span>
            <input type="date" id="activityEndDate" title="Sampai tanggal" />
            <button class="btn-apply-date" onclick="applyDateFilter()">
              Terapkan
            </button>
          </div>
        </div>

        <!-- Loading State -->
        <div id="activitiesLoading" class="activities-loading">
          <p>⏳ Memuat riwayat aktivitas...</p>
        </div>

        <!-- Activities Container -->
        <div
          id="activitiesContainer"
          class="activities-container"
          style="display: none"
        ></div>

        <!-- Empty State -->
        <div id="activitiesEmpty" class="activities-empty" style="display: none">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
            />
          </svg>
          <p>Belum ada riwayat aktivitas</p>
          <p style="font-size: 0.875rem; margin-top: 0.5rem">
            Mulai belanja atau tukar reward untuk melihat riwayat Anda
          </p>
        </div>

        <!-- Error State for Activities -->
        <div id="activitiesError" class="activities-empty" style="display: none">
          <p style="color: #b91c1c">❌ Gagal memuat riwayat aktivitas</p>
          <button
            class="btn-apply-date"
            onclick="loadActivities()"
            style="margin-top: 1rem"
          >
            Coba Lagi
          </button>
        </div>

        <!-- Pagination -->
        <div id="activitiesPagination" class="activities-pagination"></div>
      </div>

      <!-- Activity Detail Modal (Custom - renders HTML content) -->
      <div
        id="activityDetailModal"
        class="activity-modal-overlay"
        style="display: none"
        onclick="closeActivityDetailModal(event)"
      >
        <div class="activity-modal-box" onclick="event.stopPropagation()">
          <div class="activity-modal-header">
            <h3 id="activityModalTitle">Detail</h3>
            <button
              class="activity-modal-close"
              onclick="closeActivityDetailModal()"
            >
              ×
            </button>
          </div>
          <div id="activityModalContent" class="activity-modal-content">
            <!-- Content will be injected here -->
          </div>
          <div class="activity-modal-footer">
            <button class="btn-apply-date" onclick="closeActivityDetailModal()">
              Tutup
            </button>
          </div>
        </div>
      </div>

      <!-- Error State -->
      <div
        id="errorState"
        style="display: none; text-align: center; padding: 3rem"
      >
        <p class="text-red-600 mb-4">
          Gagal memuat data profile. Silakan login terlebih dahulu.
        </p>
        <button onclick="window.location.href='/login'" class="btn btn-primary">
          Login
        </button>
      </div>
    </main>

    <!-- Scripts -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      lucide.createIcons();
    </script>
    <script src="js/modal-utils.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/script.js"></script>
    <script src="js/landing-navbar.js"></script>

    <!-- Profile Logic -->
    <script>
      // Card type mapping (same as register page)
      const cardTypeMapping = {
        "Active-Worker": {
          front: "/uploads/gambar_kartu/depan/Background-Active-Worker.png",
          back: "/uploads/gambar_kartu/belakang/Tampilan-Belakang-Active-Worker.png",
          label: "Active Worker",
        },
        "Family-Member": {
          front: "/uploads/gambar_kartu/depan/Background-Family-Member.png",
          back: "/uploads/gambar_kartu/belakang/Tampilan-Belakang-Family-Member.png",
          label: "Family Member",
        },
        "Healthy-Smart-Kids": {
          front:
            "/uploads/gambar_kartu/depan/Background-Healthy-&-Smart-Kids.png",
          back: "/uploads/gambar_kartu/belakang/Tampilan-Belakang-Healthy-&-Smart-Kids.png",
          label: "Healthy & Smart Kids",
        },
        "Mums-Baby": {
          front: "/uploads/gambar_kartu/depan/Background-Mums-&-Baby.png",
          back: "/uploads/gambar_kartu/belakang/Tampilan-Belakang-Mums-&-Baby.png",
          label: "Mums & Baby",
        },
        "New-Couple": {
          front: "/uploads/gambar_kartu/depan/Background-New-Couple.png",
          back: "/uploads/gambar_kartu/belakang/Tampilan-Belakang-New-Couple.png",
          label: "New Couple",
        },
        "Pregnant-Preparation": {
          front:
            "/uploads/gambar_kartu/depan/Background-Pregnant-Preparatiom.png",
          back: "/uploads/gambar_kartu/belakang/Tampilan-Belakang-Pregnant-Preparatiom.png",
          label: "Pregnant Preparation",
        },
        "Senja-Ceria": {
          front: "/uploads/gambar_kartu/depan/Background-Senja-Ceria.png",
          back: "/uploads/gambar_kartu/belakang/Tampilan-Belakang-Senja-Ceria.png",
          label: "Senja Ceria",
        },
      };

      // Flip card on click
      const profileCardFlipWrapper = document.getElementById(
        "profileCardFlipWrapper"
      );
      profileCardFlipWrapper.addEventListener("click", function () {
        this.classList.toggle("flipped");
      });

      // Load profile data
      async function loadProfileData() {
        try {
          // Get user data
          const response = await fetch("/api/auth/me", {
            credentials: "include",
          });

          if (!response.ok) {
            throw new Error("Not authenticated");
          }

          const result = await response.json();

          if (!result.success || !result.data) {
            throw new Error("Failed to load profile");
          }

          const user = result.data;

          // Get points data
          let points = 0;
          try {
            const progressResponse = await fetch("/api/user-data/progress", {
              credentials: "include",
            });
            if (progressResponse.ok) {
              const progressData = await progressResponse.json();
              if (progressData.success && progressData.data) {
                points = progressData.data.points || 0;
              }
            }
          } catch (e) {
            console.log("Could not load points:", e);
          }

          // Update UI
          displayProfileData(user, points);

          // Hide loading, show content
          document.getElementById("loadingState").style.display = "none";
          document.getElementById("profileContent").style.display = "block";

          // Load activity history after profile loads successfully
          if (typeof loadActivities === "function") {
            loadActivities();
          }
        } catch (error) {
          console.error("Error loading profile:", error);
          document.getElementById("loadingState").style.display = "none";
          document.getElementById("errorState").style.display = "block";
        }
      }

      function displayProfileData(user, points) {
        // Get first letter for avatar
        const firstLetter = user.name.charAt(0).toUpperCase();

        // Update header
        document.getElementById("profileAvatar").textContent = firstLetter;
        document.getElementById("profileName").textContent = user.name;
        document.getElementById("profileEmail").textContent = user.email;

        // Update email verification status
        const emailStatusEl = document.getElementById("infoEmailStatus");
        const verifyActionEl = document.getElementById("verifyNowAction");
        
        // Convert to boolean explicitly (handles both 0/1 and true/false)
        const isVerified = !!user.is_email_verified;
        
        if (isVerified) {
          emailStatusEl.innerHTML = `
            <span class="flex items-center gap-1.5 text-emerald-600 font-bold">
              <i data-lucide="check-circle" class="w-4 h-4"></i>
              Terverifikasi
            </span>
          `;
          verifyActionEl.style.display = "none";
        } else {
          emailStatusEl.innerHTML = `
            <span class="flex items-center gap-1.5 text-amber-600 font-bold">
              <i data-lucide="alert-circle" class="w-4 h-4"></i>
              Belum Verifikasi
            </span>
          `;
          verifyActionEl.style.display = "block";
        }

        // Re-run lucide icons if added
        if (window.lucide) window.lucide.createIcons();

        // Update info rows
        document.getElementById("infoName").textContent = user.name;
        document.getElementById("infoEmail").textContent = user.email;
        document.getElementById("infoPhone").textContent = user.phone;

        // Update card type
        const cardType = user.card_type || "Active-Worker";
        const cardData = cardTypeMapping[cardType];

        if (cardData) {
          document.getElementById("infoCardType").textContent = cardData.label;

          // Update card preview
          document.getElementById("profileCardFrontImage").src = cardData.front;
          document.getElementById("profileCardBackImage").src = cardData.back;
          document.getElementById("profileCardNameDisplay").textContent =
            user.name;
          document.getElementById("profileCardPhoneDisplay").textContent =
            user.phone;
          document.getElementById(
            "profileCardPointsDisplay"
          ).textContent = `${points} Points`;

          // Apply smaller font and lower position for specific card types
          const smallNameTypes = [
            "Mums-Baby",
            "New-Couple",
            "Pregnant-Preparation",
          ];
          const nameElement = document.getElementById("profileCardNameDisplay");
          const infoElement = document.getElementById("profileCardInfo");
          if (smallNameTypes.includes(cardType)) {
            nameElement.classList.add("card-name-small");
            if (infoElement) infoElement.classList.add("card-info-lower");
          } else {
            nameElement.classList.remove("card-name-small");
            if (infoElement) infoElement.classList.remove("card-info-lower");
          }
        }

        // Update points (if element exists)
        const infoPointsEl = document.getElementById("infoPoints");
        if (infoPointsEl) {
          infoPointsEl.textContent = `${points} Points`;
        }

        // Update navbar points (desktop and mobile)
        const pointsDisplay = document.getElementById("pointsDisplay");
        const pointsValue = document.getElementById("pointsValue");
        if (pointsDisplay && pointsValue) {
          pointsValue.textContent = points;
          pointsDisplay.style.display = "block";
        }

        const mobilePointsDisplay = document.getElementById(
          "mobilePointsDisplay"
        );
        const mobileNavPoints = document.getElementById("mobileNavPoints");
        if (mobilePointsDisplay && mobileNavPoints) {
          mobileNavPoints.textContent = points;
          mobilePointsDisplay.style.display = "block";
        }

        // Show profile and logout buttons
        const profileBtn = document.getElementById("profileBtn");
        const mobileProfileBtn = document.getElementById("mobileProfileBtn");
        if (profileBtn) profileBtn.style.display = "block";
        if (mobileProfileBtn) mobileProfileBtn.style.display = "block";
      }

      // Logout functionality (using handleLogout from script.js)
      const logoutBtn = document.getElementById("logoutBtn");
      const mobileLogoutBtn = document.getElementById("mobileLogoutBtn");

      if (logoutBtn) {
        logoutBtn.style.display = "block";
        if (typeof handleLogout === "function") {
          logoutBtn.addEventListener("click", handleLogout);
        }
      }

      if (mobileLogoutBtn) {
        mobileLogoutBtn.style.display = "block";
        if (typeof handleLogout === "function") {
          mobileLogoutBtn.addEventListener("click", handleLogout);
        }
      }

      // Resend verification email
      async function resendVerification() {
        const btn = document.getElementById("resendVerifyBtn");
        const originalText = btn.innerHTML;
        
        try {
          btn.disabled = true;
          btn.innerHTML = '<i data-lucide="loader-2" class="w-3.5 h-3.5 animate-spin"></i> Mengirim...';
          if (window.lucide) window.lucide.createIcons();

          const response = await fetch("/api/auth/resend-verification", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            credentials: "include"
          });

          const data = await response.json();
          
          if (data.success) {
            showSuccess(data.message);
            btn.innerHTML = '<i data-lucide="check" class="w-3.5 h-3.5"></i> Terkirim!';
            setTimeout(() => {
              btn.disabled = false;
              btn.innerHTML = originalText;
              if (window.lucide) window.lucide.createIcons();
            }, 5000);
          } else {
            showError(data.error || "Gagal mengirim email verifikasi");
            btn.disabled = false;
            btn.innerHTML = originalText;
          }
        } catch (error) {
          console.error("Resend error:", error);
          showError("Terjadi kesalahan teknis");
          btn.disabled = false;
          btn.innerHTML = originalText;
        }
        if (window.lucide) window.lucide.createIcons();
      }

      // Load data on page load
      loadProfileData();

      // ============================================
      // ACTIVITY HISTORY FUNCTIONALITY
      // ============================================

      // State variables for activity history
      let currentActivityPage = 1;
      let currentActivityType = "all";
      let currentStartDate = "";
      let currentEndDate = "";

      // Load activities from API
      async function loadActivities(
        page = 1,
        type = "all",
        startDate = "",
        endDate = ""
      ) {
        const loadingEl = document.getElementById("activitiesLoading");
        const containerEl = document.getElementById("activitiesContainer");
        const emptyEl = document.getElementById("activitiesEmpty");
        const errorEl = document.getElementById("activitiesError");
        const paginationEl = document.getElementById("activitiesPagination");

        // Show loading, hide others
        loadingEl.style.display = "block";
        containerEl.style.display = "none";
        emptyEl.style.display = "none";
        errorEl.style.display = "none";
        paginationEl.innerHTML = "";

        try {
          // Build query params
          const params = new URLSearchParams({
            page: page.toString(),
            limit: "10",
            type: type,
          });
          if (startDate) params.append("startDate", startDate);
          if (endDate) params.append("endDate", endDate);

          const response = await fetch(
            `/api/user-data/activities?${params.toString()}`,
            { credentials: "include" }
          );

          if (!response.ok) {
            throw new Error("Failed to fetch activities");
          }

          const result = await response.json();

          if (!result.success) {
            throw new Error(result.error || "Failed to load activities");
          }

          const { activities, totalCount, currentPage, totalPages } =
            result.data;

          // Update state
          currentActivityPage = currentPage;
          currentActivityType = type;
          currentStartDate = startDate;
          currentEndDate = endDate;

          // Hide loading
          loadingEl.style.display = "none";

          if (activities.length === 0) {
            // Show empty state
            emptyEl.style.display = "block";
          } else {
            // Render activities
            containerEl.style.display = "flex";
            renderActivityCards(activities);

            // Render pagination if needed
            if (totalPages > 1) {
              renderPagination(currentPage, totalPages);
            }
          }
        } catch (error) {
          console.error("Error loading activities:", error);
          loadingEl.style.display = "none";
          errorEl.style.display = "block";
        }
      }

      // Render activity cards
      function renderActivityCards(activities) {
        const container = document.getElementById("activitiesContainer");
        container.innerHTML = activities.map(createActivityCard).join("");
      }

      // Create single activity card HTML
      function createActivityCard(activity) {
        const isOrder = activity.type === "order";
        const icon = isOrder ? "🛒" : "🎁";
        const iconClass = isOrder ? "order" : "reward";

        // Format date using global formatDateTime if available, else fallback
        const dateStr =
          typeof formatDateTime === "function"
            ? formatDateTime(activity.activity_date)
            : new Date(activity.activity_date).toLocaleString("id-ID");

        // Title
        const title = isOrder
          ? `Order #${escapeHtml(activity.order_number)}`
          : escapeHtml(activity.reward_name);

        // Amount/Points
        let amountHtml = "";
        if (isOrder) {
          const formatted =
            typeof formatCurrency === "function"
              ? formatCurrency(activity.total_amount)
              : `Rp ${activity.total_amount.toLocaleString("id-ID")}`;
          amountHtml = `
            <div class="activity-value">${formatted}</div>
            <div class="activity-points">+${activity.points_earned} poin</div>
          `;
        } else {
          amountHtml = `
            <div class="activity-value" style="color: #b45309;">-${activity.points_cost} poin</div>
          `;
        }

        // Status badge
        const statusBadge = getActivityStatusBadge(activity.status, isOrder);

        // Click handler
        const clickHandler = isOrder
          ? `openOrderDetailModal(${activity.id})`
          : `openRewardDetailModal(${activity.id})`;

        return `
          <div class="activity-card ${iconClass}" onclick="${clickHandler}">
            <div class="activity-icon ${iconClass}">${icon}</div>
            <div class="activity-info">
              <div class="activity-title">${title}</div>
              <div class="activity-date">${dateStr}</div>
              ${statusBadge}
            </div>
            <div class="activity-amount">
              ${amountHtml}
            </div>
          </div>
        `;
      }

      // Get status badge HTML - uses shared utility from utils.js
      // This is a thin wrapper for backward compatibility with existing code
      function getActivityStatusBadge(status, isOrder) {
        const activityType = isOrder ? "order" : "reward";
        // Use the shared utility function from js/utils.js
        return typeof getActivityStatusBadgeHtml === "function"
          ? getActivityStatusBadgeHtml(status, activityType)
          : `<span class="status-badge">${status}</span>`; // Fallback
      }

      // Render pagination buttons
      function renderPagination(currentPage, totalPages) {
        const container = document.getElementById("activitiesPagination");
        let html = "";

        // Previous button
        html += `<button class="page-btn" onclick="goToActivityPage(${
          currentPage - 1
        })" ${currentPage === 1 ? "disabled" : ""}>← Prev</button>`;

        // Page numbers (show max 5 pages)
        const startPage = Math.max(1, currentPage - 2);
        const endPage = Math.min(totalPages, startPage + 4);

        for (let i = startPage; i <= endPage; i++) {
          html += `<button class="page-btn ${
            i === currentPage ? "active" : ""
          }" onclick="goToActivityPage(${i})">${i}</button>`;
        }

        // Next button
        html += `<button class="page-btn" onclick="goToActivityPage(${
          currentPage + 1
        })" ${currentPage === totalPages ? "disabled" : ""}>Next →</button>`;

        container.innerHTML = html;
      }

      // Go to specific page
      function goToActivityPage(page) {
        loadActivities(
          page,
          currentActivityType,
          currentStartDate,
          currentEndDate
        );
      }

      // Filter chip click handler
      function handleFilterClick(type) {
        // Update active state
        document.querySelectorAll(".filter-chip").forEach((chip) => {
          chip.classList.remove("active");
          if (chip.dataset.type === type) {
            chip.classList.add("active");
          }
        });

        // Reload with new filter
        loadActivities(1, type, currentStartDate, currentEndDate);
      }

      // Apply date filter
      function applyDateFilter() {
        const startDate =
          document.getElementById("activityStartDate").value || "";
        const endDate = document.getElementById("activityEndDate").value || "";
        loadActivities(1, currentActivityType, startDate, endDate);
      }

      // Open order detail modal (receipt style)
      async function openOrderDetailModal(orderId) {
        try {
          const response = await fetch(
            `/api/user-data/activities/order/${orderId}`,
            { credentials: "include" }
          );

          if (!response.ok) {
            throw new Error("Failed to fetch order");
          }

          const result = await response.json();
          if (!result.success) {
            throw new Error(result.error);
          }

          const order = result.data;

          // Parse items if string
          const items =
            typeof order.items === "string"
              ? JSON.parse(order.items)
              : order.items;

          // Format date
          const dateStr =
            typeof formatDateTime === "function"
              ? formatDateTime(order.created_at)
              : new Date(order.created_at).toLocaleString("id-ID");

          // Build items HTML
          let itemsHtml = items
            .map((item) => {
              const price = parseFloat(item.price) || 0;
              const qty = parseInt(item.quantity) || 1;
              const subtotal = price * qty;
              return `
              <div class="receipt-item">
                <span class="receipt-item-name">${escapeHtml(item.name)}</span>
                <span class="receipt-item-qty">x${qty}</span>
                <span class="receipt-item-price">${
                  typeof formatCurrency === "function"
                    ? formatCurrency(subtotal)
                    : `Rp ${subtotal.toLocaleString("id-ID")}`
                }</span>
              </div>
            `;
            })
            .join("");

          // Calculate subtotal
          const subtotal = parseFloat(order.original_total || order.total_amount);
          const discount = parseFloat(order.coupon_discount) || 0;
          const total = parseFloat(order.total_amount);

          // Status badge
          const statusBadge = getActivityStatusBadge(order.status, true);

          // Build modal content
          const modalContent = `
            <div class="receipt-modal">
              <div class="receipt-header">
                <div class="receipt-logo">🐝 DocterBee</div>
                <div class="receipt-order-number">#${escapeHtml(
                  order.order_number
                )}</div>
                ${statusBadge}
              </div>
              
              <div class="receipt-info">
                <div class="receipt-info-row">
                  <span>Tanggal:</span>
                  <span>${dateStr}</span>
                </div>
                <div class="receipt-info-row">
                  <span>Lokasi:</span>
                  <span>${escapeHtml(order.store_location || "-")}</span>
                </div>
                <div class="receipt-info-row">
                  <span>Tipe:</span>
                  <span>${escapeHtml(order.order_type || "-")}</span>
                </div>
              </div>
              
              <div class="receipt-items">
                ${itemsHtml}
              </div>
              
              <div class="receipt-summary">
                ${
                  discount > 0
                    ? `
                  <div class="receipt-summary-row">
                    <span>Subtotal:</span>
                    <span>${
                      typeof formatCurrency === "function"
                        ? formatCurrency(subtotal)
                        : `Rp ${subtotal.toLocaleString("id-ID")}`
                    }</span>
                  </div>
                  <div class="receipt-summary-row" style="color: #10b981;">
                    <span>Diskon${
                      order.coupon_code ? ` (${order.coupon_code})` : ""
                    }:</span>
                    <span>-${
                      typeof formatCurrency === "function"
                        ? formatCurrency(discount)
                        : `Rp ${discount.toLocaleString("id-ID")}`
                    }</span>
                  </div>
                `
                    : ""
                }
                <div class="receipt-summary-row">
                  <span>Poin Didapat:</span>
                  <span style="color: #667eea;">+${
                    order.points_earned || 0
                  } poin</span>
                </div>
                <div class="receipt-summary-row receipt-total">
                  <span>TOTAL:</span>
                  <span>${
                    typeof formatCurrency === "function"
                      ? formatCurrency(total)
                      : `Rp ${total.toLocaleString("id-ID")}`
                  }</span>
                </div>
              </div>
              
              <div class="receipt-footer">
                Terima kasih telah berbelanja di DocterBee!
              </div>
            </div>
          `;

          // Show modal using custom activity modal (renders HTML)
          showActivityDetailModal("Struk Pembelian", modalContent);
        } catch (error) {
          console.error("Error fetching order detail:", error);
          if (typeof showError === "function") {
            showError("Gagal memuat detail order");
          } else {
            alert("Gagal memuat detail order");
          }
        }
      }

      // Open reward detail modal
      async function openRewardDetailModal(redemptionId) {
        try {
          const response = await fetch(
            `/api/user-data/activities/reward/${redemptionId}`,
            { credentials: "include" }
          );

          if (!response.ok) {
            throw new Error("Failed to fetch reward");
          }

          const result = await response.json();
          if (!result.success) {
            throw new Error(result.error);
          }

          const reward = result.data;

          // Format date
          const dateStr =
            typeof formatDateTime === "function"
              ? formatDateTime(reward.redeemed_at)
              : new Date(reward.redeemed_at).toLocaleString("id-ID");

          // Status badge
          const statusBadge = getActivityStatusBadge(reward.status, false);

          // Status explanation
          let statusExplanation = "";
          if (reward.status === "pending") {
            statusExplanation =
              '<p style="font-size: 0.875rem; color: #6b7280; margin-top: 1rem;">Penukaran Anda sedang diproses oleh admin. Mohon tunggu konfirmasi.</p>';
          } else if (reward.status === "approved") {
            statusExplanation =
              '<p style="font-size: 0.875rem; color: #047857; margin-top: 1rem;">✅ Penukaran telah disetujui! Silakan ambil reward Anda di toko.</p>';
          } else if (reward.status === "rejected") {
            statusExplanation =
              '<p style="font-size: 0.875rem; color: #b91c1c; margin-top: 1rem;">❌ Penukaran ditolak. Poin telah dikembalikan ke akun Anda.</p>';
          }

          // Build modal content
          const modalContent = `
            <div style="text-align: center; padding: 1rem;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">🎁</div>
              <h3 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">
                ${escapeHtml(reward.reward_name)}
              </h3>
              <div style="font-size: 1.25rem; color: #b45309; font-weight: bold; margin-bottom: 1rem;">
                -${reward.points_cost} Poin
              </div>
              <div style="color: #6b7280; margin-bottom: 1rem;">
                ${dateStr}
              </div>
              ${statusBadge}
              ${statusExplanation}
            </div>
          `;

          // Show modal using custom activity modal (renders HTML)
          showActivityDetailModal("Detail Penukaran Reward", modalContent);
        } catch (error) {
          console.error("Error fetching reward detail:", error);
          if (typeof showError === "function") {
            showError("Gagal memuat detail reward");
          } else {
            alert("Gagal memuat detail reward");
          }
        }
      }

      // Add event listeners to filter chips
      document.querySelectorAll(".filter-chip").forEach((chip) => {
        chip.addEventListener("click", () =>
          handleFilterClick(chip.dataset.type)
        );
      });

      // ============================================
      // CUSTOM ACTIVITY DETAIL MODAL FUNCTIONS
      // ============================================

      // Show activity detail modal with HTML content
      function showActivityDetailModal(title, htmlContent) {
        const modal = document.getElementById("activityDetailModal");
        const titleEl = document.getElementById("activityModalTitle");
        const contentEl = document.getElementById("activityModalContent");

        if (modal && titleEl && contentEl) {
          titleEl.textContent = title;
          contentEl.innerHTML = htmlContent; // Renders HTML
          modal.style.display = "flex";
          document.body.style.overflow = "hidden"; // Prevent background scroll
        }
      }

      // Close activity detail modal
      function closeActivityDetailModal(event) {
        // If event exists and target is not the overlay, don't close
        if (event && event.target && event.target.id !== "activityDetailModal") {
          return;
        }

        const modal = document.getElementById("activityDetailModal");
        if (modal) {
          modal.style.display = "none";
          document.body.style.overflow = ""; // Restore scroll
        }
      }

      // Close on ESC key
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closeActivityDetailModal();
        }
      });

      // ============================================
      // CHANGE PASSWORD FUNCTIONALITY
      // ============================================

      // Toggle password visibility
      function togglePasswordVisibility(inputId, button) {
        const input = document.getElementById(inputId);
        if (!input) return;
        
        const isPassword = input.type === "password";
        input.type = isPassword ? "text" : "password";
        
        // Update icon (eye open vs eye closed)
        const svg = button.querySelector("svg");
        if (svg) {
          if (isPassword) {
            // Show eye-off icon (password visible)
            svg.innerHTML = `
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
              <line x1="1" y1="1" x2="23" y2="23"></line>
            `;
          } else {
            // Show eye icon (password hidden)
            svg.innerHTML = `
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            `;
          }
        }
      }

      // Handle change password form submission
      const changePasswordForm = document.getElementById("changePasswordForm");
      if (changePasswordForm) {
        changePasswordForm.addEventListener("submit", async function(e) {
          e.preventDefault();
          
          const currentPassword = document.getElementById("currentPassword").value.trim();
          const newPassword = document.getElementById("newPassword").value.trim();
          const confirmPassword = document.getElementById("confirmPassword").value.trim();
          const submitBtn = document.getElementById("changePasswordBtn");
          
          // Frontend validation
          if (!currentPassword || !newPassword || !confirmPassword) {
            showWarning("Semua field harus diisi");
            return;
          }
          
          if (newPassword.length < 6) {
            showWarning("Password baru minimal 6 karakter");
            return;
          }
          
          if (newPassword !== confirmPassword) {
            showError("Password baru dan konfirmasi tidak cocok");
            return;
          }
          
          // Disable button during request
          const originalText = submitBtn.textContent;
          submitBtn.disabled = true;
          submitBtn.textContent = "Memproses...";
          
          try {
            const response = await fetch("/api/auth/change-password", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              credentials: "include",
              body: JSON.stringify({ currentPassword, newPassword })
            });
            
            const data = await response.json();
            
            if (response.ok && data.success) {
              showSuccess(data.message || "Password berhasil diubah. Gunakan password baru untuk login berikutnya.");
              // Clear form
              changePasswordForm.reset();
            } else {
              // Handle unverified email error (403 from backend)
              if (response.status === 403) {
                 showWarning(
                   "Gagal Mengubah Password!\n\n" +
                   "Akun Anda harus terverifikasi untuk mengubah password.\n\n" +
                   "Silakan verifikasi email Anda terlebih dahulu di bagian Informasi Akun.",
                   "Verifikasi Diperlukan"
                 );
                 return;
              }
              showError(data.error || "Gagal mengubah password");
            }
          } catch (error) {
            console.error("Error changing password:", error);
            showError("Terjadi kesalahan teknis. Silakan coba lagi nanti.");
          } finally {
            // Re-enable button
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
          }
        });
      }
    </script>

    <!-- ================= FOOTER ================= -->
    <footer>
      <div class="container">
        <div class="footer-content">
          <div>© 2025 DocterBee. All rights reserved.</div>
          <div>
            Berbasis <strong>Sains & Alam</strong>. | <a href="#">Privacy</a> ·
            <a href="#">Terms</a>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>
